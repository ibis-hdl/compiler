/*
 * compiler_support.hpp
 *
 *  Created on: 02.04.2017
 *      Author: cmake build
 */

#ifndef SOURCES_COMMON_INCLUDE_EDA_COMPILER_COMPILER_SUPPORT_HPP_IN_
#define SOURCES_COMMON_INCLUDE_EDA_COMPILER_COMPILER_SUPPORT_HPP_IN_


/* cmake platform check results start */


/* Define to 1 if the compiler supports __builtin_unreachable. */
#cmakedefine EDA_HAVE_BUILTIN_UNREACHABLE 1


/* Define to 1 if the compiler supports __builtin_expect. */
#cmakedefine EDA_HAVE_BUILTIN_EXPECT 1


/* Define to 1 if the compiler supports __assume. */
#cmakedefine EDA_HAVE_BUILTIN_ASSUME 1


/* Define to 1 if the compiler supports C++11 quick_exit.  */
#cmakedefine EDA_HAVE_STD_QUICK_EXIT 1


/* cmake platform check results end */



/* -----------------------------------------------------------------------------
 * Handling of cmake's platform check results
 */

// use __builtin_expect to provide the compiler with branch prediction information
#if defined(EDA_HAVE_BUILTIN_EXPECT)
#define cxx_expect(x)       __builtin_expect(!!(x), 1)
#define cxx_expect_false(x) __builtin_expect(!!(x), 0)
elif defined(EDA_HAVE_BUILTIN_ASSUME)
#define cxx_expect(x)       __assume((x))
#define cxx_expect_false(x) __assume(!(x))
#else
#define cxx_expect(x)       x
#define cxx_expect_false(x) x
#endif


#if defined (EDA_HAVE_BUILTIN_UNREACHABLE)
#define cxx_unreachable() __builtin_unreachable();
#elif defined (EDA_HAVE_BUILTIN_ASSUME)
#define cxx_unreachable() __assume(0);
#else
#define cxx_unreachable() ((void)0)
#endif


#if defined(EDA_HAVE_STD_QUICK_EXIT)
#define std_quick_exit(EXIT_CODE)  \
std::quick_exit(EXIT_CODE)
#else
#define std_quick_exit(EXIT_CODE)  \
std::exit(EXIT_CODE);
#endif


#endif /* SOURCES_COMMON_INCLUDE_EDA_COMPILER_COMPILER_SUPPORT_HPP_IN_ */
